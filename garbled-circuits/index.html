<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="author" content="Elijah Voigt">
    <link rel="stylesheet" type="text/css" href="../theme/css/styles.css"/>
        <link href="/rss.xml" type="application/rss+xml"   rel="alternate" title="elijahcaine.me RSS Feed" />
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="elijahcaine.me Atom Feed" />
  </head>

  <body>
    <div class="site">
      <header>
        <a href="/">(üè† elijahcaine.me)</a>
        <a href="https://github.com/pop/">(üêô github üê±)</a>
        <a href="/Elijah Voigt.pdf">(üëî resume)</a>
        <a href="/atom.xml">(üì∞ feed)</a>
      </header>

      <div id="content">

<div class="post">
  <h1 class="posttitle">
    Garbled Circuits
  </h1>

  <div class="postinfo">
    <p class="published" title="2017-10-30T00:00:00-07:00">
      Mon 30 October 2017
    </p>
  </div>
</div>

<div class="article">
  <div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a part of a series of blog posts I wrote for an Independent Study on cryptography at Oregon State University.
To read all of the posts, check out the 'Independent Crypto' tag.</p>
</div>
<p>Let's imagine you are a billionaire.
You want to know if you have more money than your billionaire friend Bob, but for some reason it's <em>very</em> faux pas to let anybody know how much money you have, even your good friend Bob.</p>
<p>But you're a billionaire!
You're not used to the phrase &quot;that isn't possible&quot;.
In your frustration you try to figure out if you can use some of your billions to find a solution.</p>
<p>The first solution you come up with is Trusty Tina.
You tell Tina how much you make, Bob tells Tina how much he makes, and then Tina tells both of you who makes more.</p>
<p>The only problem is that Tina isn't <em>that</em> trustworthy, her parent's just named her that.
Like... you wouldn't trust her with your life or anything.
You could pay her to keep your assets secret but Bob might pay her a bit more reveal your number to him.
Tina reminds you of this so you have to pay her <em>more</em> to keep the secret, and eventually you have an arms-race type situation at hand.
With your cunning accountant skills you can already tell that Tina might be more trouble than she's worth.</p>
<p>If you won't tell Bob directly, and you can't depend on Manipulative Tina, is there <em>any</em> way to determine out who has more money?</p>
<p>Yes.</p>
<div class="section" id="party-secure-function-evaluation">
<h2>2-Party Secure Function Evaluation</h2>
<p>The problem above is the Millionaires problem <a class="footnote-reference" href="#id20" id="id1">[9]</a> and it is solved by the use of 2-party secure function evaluation (SFE).
The general idea <a class="footnote-reference" href="#id18" id="id2">[4]</a> is that you have a function <tt class="docutils literal">f</tt> which takes as input <tt class="docutils literal">x</tt> and <tt class="docutils literal">y</tt>.
This function is garbled by one of the two parties into <tt class="docutils literal">f'</tt> and the inputs are garbled into <tt class="docutils literal">x'</tt> and <tt class="docutils literal">y'</tt> by each of the parties.
<tt class="docutils literal"><span class="pre">f'(x',</span> y') == f(x,y)</tt> but does not leak any of the inputs, because <tt class="docutils literal">x</tt> and <tt class="docutils literal">y</tt> were obfuscated.</p>
<p>In other words...</p>
<ol class="arabic simple">
<li>Alice and Bob agree on a function (i.e., circuit) <tt class="docutils literal">f(a,b)</tt>.</li>
<li>Alice garbles the function (<em>cough</em> circuit) <tt class="docutils literal">f</tt> and her input <tt class="docutils literal">a</tt>.</li>
<li>Alice sends <tt class="docutils literal">f'</tt> and <tt class="docutils literal">a'</tt> to Bob.</li>
<li>Bob gets his input <tt class="docutils literal">b</tt> garbled into <tt class="docutils literal">b'</tt>.</li>
<li>Bob evaluates <tt class="docutils literal"><span class="pre">f'(a',</span> b')</tt>.</li>
<li>This reveals the result of <tt class="docutils literal">f(a,b)</tt> to Bob, but does not reveal Alice's input.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The first half of this post focuses on honest garbled circuit uses, meaning both parties are acting honestly (and don't pull any fast-ones).</p>
<p class="last">The latter portion focuses on problems with that 'vanilla' garbled circuit implementation and potential solutions.</p>
</div>
</div>
<div class="section" id="garbling-a-gate">
<h2>Garbling a gate</h2>
<p>How does Alice actually... 'garble' a circuit?
It sounds kinda dirty.</p>
<p>Each gate (OR, AND, XOR, etc) has two inputs.
Stick with me.
Each input is encrypted.
Keeping up?
So you need a <em>key</em> to use <em>each gate</em>.
It gets better.
But if you have the keys, you don't know which key corresponds with a <tt class="docutils literal">1</tt> or a <tt class="docutils literal">0</tt> so you can compute a function without knowing the actual values you put in.
Whoa.</p>
<p>Let's use the OR gate as an example.</p>
<p>Remember truth-tables for OR?
Here's a reminder:</p>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="27%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">OR</th>
<th class="head">0</th>
<th class="head">1</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>0</strong></td>
<td>0</td>
<td>1</td>
</tr>
<tr><td><strong>1</strong></td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>This table is going to be important for Alice's part of this dance.</p>
<div class="section" id="alice-s-circuit-input">
<h3>Alice's circuit &amp; input</h3>
<p>Alice definitely does the heavy lifting in this transaction.</p>
<ol class="arabic simple">
<li>Alice generates 4 keys <tt class="docutils literal">Kx0</tt>, <tt class="docutils literal">Kx1</tt>, <tt class="docutils literal">Ky0</tt>, and <tt class="docutils literal">Ky1</tt>.</li>
<li>Alice creates four variables corresponding with the four values in the OR table:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="41%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">OR</th>
<th class="head">0</th>
<th class="head">1</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>0</strong></td>
<td><tt class="docutils literal">B00</tt> = 0</td>
<td><tt class="docutils literal">B01</tt> = 1</td>
</tr>
<tr><td><strong>1</strong></td>
<td><tt class="docutils literal">B10</tt> = 1</td>
<td><tt class="docutils literal">B11</tt> = 1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li>Each box is encrypted with the two keys:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="43%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">OR</th>
<th class="head">0</th>
<th class="head">1</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>0</strong></td>
<td><tt class="docutils literal"><span class="pre">E(Kx0||Ky0,</span> B00)</tt></td>
<td><tt class="docutils literal"><span class="pre">E(Kx0||Ky1,</span> B01)</tt></td>
</tr>
<tr><td><strong>1</strong></td>
<td><tt class="docutils literal"><span class="pre">E(Kx1||Ky0,</span> B10)</tt></td>
<td><tt class="docutils literal"><span class="pre">E(Kx1||Ky1,</span> B11)</tt></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li>Alice sends these ciphertexts (unordered) to Bob.</li>
</ol>
</div>
<div class="section" id="bob-s-input">
<h3>Bob's input</h3>
<ol class="arabic simple" start="5">
<li>Bob gets Alice's input, key <tt class="docutils literal">KxA</tt>, from Alice.</li>
<li>Bob uses oblivious transfer <a class="footnote-reference" href="#id19" id="id3">[5]</a> to get his input <tt class="docutils literal">KyB</tt>.</li>
<li>With these two keys Bob is able to process the circuit (an OR gate).</li>
</ol>
<p>Bob has enough information to get one of the four possible outputs of the circuit, but doesn't know if Alice's input is a 1 or a 0.</p>
<p>Importantly, while Bob can share the output of the circuit, he should <strong>not</strong> share his input.
That would make using OT (step 6) obtuse.</p>
</div>
<div class="section" id="extending-the-garbled-gate">
<h3>Extending the garbled gate</h3>
<img alt="Garbled circuit example diagram." class="align-center" src="/assets/images/independent-crypto/garbled-circuit.jpg" style="width: 100%;" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The UTF-8 Padlock symbol doesn't render on my browser because I seem to have gone back in the time to the late 90s.
Being stuck in the past, we have to comprmise.
The ‚õ® symbol is meant to represent a lock and the ‚öø represents a key.</p>
</div>
<p>Multiple gates can be connected together to build more complicated circuits.
One important difference is that while each intermediate circuit still has four cipher-texts, for the four outcomes of a truth-table, those decrypt to a <em>key</em> and not a 1 or 0.
The only gates which decrypt to a plain-text of 0 or 1 are output gates, not the intermediate gates.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>PSST</em> Check out the end of this post for a <strong>GAME</strong>!</p>
</div>
</div>
</div>
<div class="section" id="problems-with-garbled-circuits">
<h2>Problems with garbled circuits</h2>
<p>There are a few important flaws in the <em>security</em> of garbled circuits as they have been described.
The first is that although Alice and Bob agree on a circuit to garble there is no guarantee that the circuit one is evaluating (if you're Bob) is the circuit you agreed upon.</p>
<p>For example:</p>
<ol class="arabic simple">
<li>Alice and Bob 'agree' on a function <tt class="docutils literal">f(a,b)</tt>.</li>
<li>Alice creates her own function <tt class="docutils literal">g(a,b)</tt>.</li>
<li>Alice garbles <tt class="docutils literal">g</tt> and her input <tt class="docutils literal">a</tt> and sends it to Bob as <tt class="docutils literal">f'</tt> and <tt class="docutils literal">a'</tt>.</li>
<li>Bob evaluates <tt class="docutils literal"><span class="pre">g'(a',b')</span></tt> and reveals the output to Alice. Alice now knows something other than than Bob agreed to.</li>
</ol>
</div>
<div class="section" id="improvements-on-garbled-circuit-security">
<h2>Improvements on garbled circuit security</h2>
<p>To prevent the above adversarial attack we do something called &quot;Cut-and-Choose&quot;.
This is when Bob checks Alice's work to make sure she's not cheating.</p>
<p>Remember that Alice and Bob agreed on a given circuit.</p>
<ol class="arabic simple">
<li>Alice generates M garbled circuits for the agreed upon function where M &gt; 1.</li>
<li>All secrets for a randomly chosen N circuits are revealed where 1 ‚â§ N &lt; M, the circuits are &quot;opened&quot;.</li>
<li>Bob selects one of the remaining M-N circuits to evaluate as outlined earlier.</li>
</ol>
<p>This ensures that Alice is not nefarious to some statistical certainty.
She had control over how the circuits were garbled but she does not have control over which are revealed or evaluated.
If she made one (or two or three...) nefarious circuits that bad behavior is <em>probably</em> revealed in step 2, if all the checked circuits are good Alice is <em>probably</em> being honest.</p>
<p>This doesn't break garbled circuits for the following reasons:</p>
<ul class="simple">
<li>While Alice reveals the secrets of the N circuits, she doesn't reveal anything about her input. We are only un-garbling the circuit not the inputs (revealing all possible inputs, not Alice's).</li>
<li>We're not un-garbling the M-N circuits which may be evaluated, so those are still secret.</li>
</ul>
<p>As M grows and N approaches M this method gets more secure at the cost of computation cycles and bandwidth in transferring the garbled circuits.</p>
</div>
<div class="section" id="the-free-xor-optimization">
<h2>The &quot;Free XOR&quot; Optimization</h2>
<p>I'm definitely not a circuits person.
You can show me a circuit diagram and I'll say &quot;Yep, that's a circuit. What's it do?&quot;
I couldn't even even identify which gate is which without Wikipedia.</p>
<p>I was told during my research for this post that XOR gates are very popular with garbled circuit design, and more broadly circuit design in general.
This was shared to me in the form of a cryptic hint so I figured I'd investigate and share my findings here.</p>
<p>As it turns out the Wikipedia page notes that this XOR optimization exists and even cites the original paper published on the topic. <a class="footnote-reference" href="#id15" id="id4">[6]</a></p>
<p>The jist of this optimization is that one can very efficiently garble an XOR gate such that the output of the gate is encoded as the XOR of the keys used to unlock the gate and some known global constant.
This is in contrast with the implementations discussed in the beginning where each gate had to be decrypted with two cipher-texts and revealed another key.</p>
<p>Basically using XOR, which is pretty fast, we can avoid generating four keys per gate and instead craft 1 key which is produced as the result of 'unlocking' a gate.</p>
<p>Put a bit more formally:</p>
<blockquote>
<p>Given a gate G with input wires A and B and output wire C and a random string R, the garbled gate is obtained by XORing the garbled gates inputs C<sup>1</sup> = C<sup>0</sup> ‚äï R:</p>
<blockquote>
<div class="line-block">
<div class="line">C<sup>0</sup> = A<sup>0</sup> ‚äï B<sup>0</sup> = (A<sup>0</sup> ‚äï R ) ‚äï (B<sup>0</sup> ‚äï R) = A<sup>1</sup> ‚äï B<sup>1</sup></div>
<div class="line">C<sup>1</sup> = C<sup>0</sup> ‚äï R = A<sup>0</sup> (B<sup>0</sup> ‚äï R ) = A<sup>0</sup> ‚äï B<sup>1</sup> = (A<sup>0</sup> ‚äï R) ‚äï B<sup>0</sup> = A<sup>1</sup> ‚äï B<sup>0</sup></div>
</div>
</blockquote>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">LETTER<sup>{0,1}</sup> is short-hand for the True or False output of the given gate.</p>
</div>
<p>This isn't super intuitive, and honestly I just put those equations up there to prove that I read a paper about this.</p>
<p>The main takeaway is that 'free XOR' saves us computation generating and processing cryptographic keys by simply performing the XOR operation.
This optimization is so powerful that using <em>mostly</em> XOR gates makes garbled circuits notably faster and more useful for secure computation. <a class="footnote-reference" href="#id17" id="id5">[8]</a></p>
</div>
<div class="section" id="annotated-bibliography">
<h2>Annotated Bibliography</h2>
<dl class="docutils">
<dt>Foundations of Garbled Circuits <a class="footnote-reference" href="#id13" id="id6">[2]</a></dt>
<dd>This is by far the most thorough academic source I have.
If I had a better foundation in academic reading this might be the perfect paper but most of it went way over my head.
That said the overview of each section was fairly human-readable and gave me a good rough overview for many of the topics covered in this post.</dd>
<dt>A Brief History of Practical Garbled Circuits <a class="footnote-reference" href="#id17" id="id7">[8]</a></dt>
<dd><p class="first">This was the first source I checked out to get a feel for how difficult garbled circuits are as a topic.
It quickly glanced at the basics of garbled circuits and then quickly went into the optimizations on garbled circuits.
This was overwhelming, but as I started to learn more about garbled circuits and filled in the knowledge gaps it gained significant value.</p>
<p class="last">It's a great talk about Garbled Circuits which wasn't ideal for beginners, but did give me a good breadth of the topic and what I could dive into.</p>
</dd>
<dt>Improved garbled Circuit: Free XOR Gates and Applications <a class="footnote-reference" href="#id15" id="id8">[6]</a></dt>
<dd>This paper was useful in giving me an academic preview of the XOR optimization in Garbled Circuits.
I quickly started looking at the many other papers referenced by this one, kind of like following down the Wikipedia wormhole, but with more PDFs and less pictures.</dd>
<dt>SFE: Yao's Garbled Circuit <a class="footnote-reference" href="#id12" id="id9">[1]</a></dt>
<dd>This slide-deck was very useful as a reference for basic GCs and securing GC's with cut-and-choose.
It wasn't a great initial source for this material, but it was useful <em>after</em> I had a basic understanding of a topic to solidify it with pretty pictures and Comic Sans.</dd>
<dt>Mike Rosulek on Stack Exchange <a class="footnote-reference" href="#id14" id="id10">[3]</a> <a class="footnote-reference" href="#id16" id="id11">[7]</a></dt>
<dd>This is more of a shout-out than a citation.
Mike Rosulek's posts on crypto.stackexchange.com were very helpful in breaking down core concepts like what garbled circuits are and why XOR is &quot;free&quot;.
They also provided a good list of further reading which was helpful in addition to the resources provided in the syllabus.</dd>
</dl>
</div>
<div class="section" id="errata">
<h2>Errata</h2>
<iframe src="/garbled-circuits-game.html" height="400px" width="100%"></iframe><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Yes, the name is a misnomer.
The goal is to <em>evaluate</em> a garbled circuit, but that just doesn't roll off the tongue the same.</p>
</div>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[1]</a></td><td>SFE: Yao's Garbled Circuit,
Published by engr.illinois.edu,
for the course CS 598, Fall 2009.
<a class="reference external" href="https://courses.engr.illinois.edu/cs598man/fa2009/slides/ac-f09-lect16-yao.pdf">https://courses.engr.illinois.edu/cs598man/fa2009/slides/ac-f09-lect16-yao.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[2]</a></td><td>Foundations of Garbled Circuits,
Written by Mihir Bellare, Viet tung Hoang, and Phillip Rogaway,
Published October, 2012.
<a class="reference external" href="https://eprint.iacr.org/2012/265.pdf">https://eprint.iacr.org/2012/265.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[3]</a></td><td>What exactly is a &quot;garbled circuit&quot;?
Asked by user Ella Rose,
Answered by user Mikero on on July 27, 2016.
<a class="reference external" href="https://crypto.stackexchange.com/a/37993">https://crypto.stackexchange.com/a/37993</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id8">2</a>)</em> Improved garbled Circuit: Free XOR Gates and Applications,
Written by Vladimir Kolesnikov and Thomas Shneider,
Published July 2008.
<a class="reference external" href="http://www.cs.toronto.edu/~vlad/papers/XOR_ICALP08.pdf">http://www.cs.toronto.edu/~vlad/papers/XOR_ICALP08.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[7]</a></td><td>Why XOR and NOT is free in garbled circuits
Asked by user Jason,
Answered by user Mikero on February 28, 2017.
<a class="reference external" href="https://crypto.stackexchange.com/a/44278">https://crypto.stackexchange.com/a/44278</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><em>(<a class="fn-backref" href="#id5">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> A Brief History of Practical Garbled Circuit Optimizations,
Presented by Mike Rosulek,
Published by the Simons Institute,
June 15, 2015.
<a class="reference external" href="https://youtu.be/FTxh908u9y8">https://youtu.be/FTxh908u9y8</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[4]</a></td><td>To completely level with you, it's been anecdotally proven that there is at least 1 definition of Garbled Circuits for each paper on the topic.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[5]</a></td><td><p class="first">Oblivious Transfer has been described to me as:</p>
<ul class="simple">
<li>Alice sends two possible options to a box labeled OT.</li>
<li>Bob sends a choice to the box labeled OT.</li>
<li>Bob gets back one of the two options, without knowledge of the other.</li>
<li>Alice does not know which option Bob got.</li>
</ul>
<p class="last">This is a cryptographic primitive which is very useful for tasks like generating Bob's input to the garbled circuit <tt class="docutils literal">f'</tt>.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[9]</a></td><td>The original problem was developed in the 80's.
This post adjusts the scenario for inflation.</td></tr>
</tbody>
</table>
<!-- garbled circuits are kinda like monads.
When everybody hears about them they write a blogpost (paper) explaining them in their own unique 'intuitive' way. -->
<!-- Honestly, Yao got out of this pretty easy.
He said "Here's a thing, but I'm just gonna say it, not prove it" and everybody was like "Oh shit that could be a thing."
If he was wrong somebody would just say "Oh that's not really a thing." and inevitably *not* publish because that's boring.
If he's right (he is) he's like Euler; jotting things down in the margins for other people to prove.
At least that's the story I'm reading. -->
</div>

</div>


      </div>

      <footer>
        <p>
        ¬© 2024 Elijah Voigt, <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/assets/images/CCA4IL.png" /> Creative Commons Attribution 4.0 International</a>.
        </p>
        <p>
        This website made with locally sourced bits, built with Python üêç via Pelican üê¶, developed on Fedora üëí GNU/Linux üêÉüêß, <a href='https://github.com/pop/elijahcaine.me'>hosted</a> and deployed on GitHub üêôüê±, and served from clouds ‚õÖ.
        </p>
      </footer>
    </div>
  </body>
</html>